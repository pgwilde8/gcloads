{% extends "layout/base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10 p-8 bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl">
    <div class="flex items-center gap-4 mb-2">
        <div class="bg-green-600 p-3 rounded-2xl shadow-lg shadow-green-500/20">
            <i class="fas fa-briefcase text-white text-xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-black text-white">Digital Briefcase</h2>
            <p class="text-slate-400 text-sm">Upload your carrier docs to enable dispatch. Upload once, always on file.</p>
        </div>
    </div>

    <p class="text-slate-500 text-xs mb-8 ml-1">
        These docs are sent to brokers with every load packet. PDF only, max 20MB each.
    </p>

    <div class="space-y-4 mb-10" id="doc-slots">
        {% set total_docs = 4 %}
        {% for doc in [
            ('mc_auth',      'MC Authority',    'Carrier operating authority issued by FMCSA'),
            ('coi',          'Insurance (COI)', 'Certificate of Insurance — must show cargo &amp; liability'),
            ('w9',           'W9 Form',         'Required for payment and factoring setup'),
            ('voided_check', 'Voided Check',    'For ACH direct deposit setup with your factor')
        ] %}
        {% if doc[0] in uploaded_docs %}
        <div id="slot-{{ doc[0] }}" class="p-4 bg-green-900/20 border border-green-500/40 rounded-2xl flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-green-900/40 flex items-center justify-center text-green-400">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-green-300">{{ doc[1] }}</p>
                    <p class="text-[10px] text-green-500 uppercase tracking-widest">Uploaded</p>
                </div>
            </div>
        </div>
        {% else %}
        <div id="slot-{{ doc[0] }}" class="p-4 bg-black/40 border border-slate-800 rounded-2xl flex items-center justify-between group transition-all hover:border-green-500/50">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center text-slate-500 group-hover:bg-green-900/30 group-hover:text-green-400 transition-colors">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-slate-300">{{ doc[1] }}</p>
                    <p class="text-[10px] text-slate-500 mt-0.5">{{ doc[2] }}</p>
                </div>
            </div>
            <form hx-post="/drivers/upload-packet"
                  hx-encoding="multipart/form-data"
                  hx-target="#slot-{{ doc[0] }}"
                  hx-swap="outerHTML">
                <input type="hidden" name="doc_type" value="{{ doc[0] }}">
                <label class="cursor-pointer bg-slate-800 hover:bg-green-600 text-white text-xs font-bold px-4 py-2 rounded-lg transition-all">
                    <span>Upload</span>
                    <input type="file" name="file" accept=".pdf" class="hidden" onchange="this.form.requestSubmit()">
                </label>
            </form>
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <div id="finish-area" class="transition-all">
        <p id="finish-msg" class="text-slate-500 text-xs mb-4 text-center">
            Upload all 4 documents to activate your account.
        </p>
        <a id="finish-btn" href="/drivers/dashboard?welcome=true"
           class="block w-full bg-green-600 text-white font-black py-4 rounded-2xl shadow-lg shadow-green-500/20 active:scale-95 transition-all text-center opacity-40 pointer-events-none">
            ENTER DASHBOARD
        </a>
        <a href="/drivers/dashboard" class="block text-center text-slate-600 hover:text-slate-400 text-xs mt-4 transition">
            Skip for now — I'll finish this later
        </a>
    </div>
</div>

<script>
    const TOTAL_DOCS = 4;

    function refreshFinishState() {
        const uploaded = document.querySelectorAll('#doc-slots .fa-check-circle').length;
        const btn = document.getElementById('finish-btn');
        const msg = document.getElementById('finish-msg');
        if (uploaded >= TOTAL_DOCS) {
            btn.classList.remove('opacity-40', 'pointer-events-none');
            btn.classList.add('hover:bg-green-500');
            msg.textContent = 'All docs uploaded — system ready.';
            msg.classList.replace('text-slate-500', 'text-green-400');
        } else {
            const remaining = TOTAL_DOCS - uploaded;
            msg.textContent = `${remaining} document${remaining !== 1 ? 's' : ''} remaining.`;
        }
    }

    document.body.addEventListener('htmx:afterOnLoad', refreshFinishState);
    document.addEventListener('DOMContentLoaded', refreshFinishState);
</script>
{% endblock %}
