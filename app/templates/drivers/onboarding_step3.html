{% extends "layout/base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10 p-8 bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl">
    <div class="flex items-center gap-4 mb-8">
        <div class="bg-green-600 p-3 rounded-2xl shadow-lg shadow-green-500/20">
            <i class="fas fa-briefcase text-white text-xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-black text-white">Digital Briefcase</h2>
            <p class="text-slate-400 text-sm">Upload your "Golden Trio" to enable 1-Click Dispatching.</p>
        </div>
    </div>

    <div class="space-y-4 mb-10">
        {% for doc in [('mc_auth', 'MC Authority'), ('coi', 'Insurance (COI)'), ('w9', 'W9 Form')] %}
        {% if doc[0] in uploaded_docs %}
        <div id="slot-{{ doc[0] }}" class="p-4 bg-green-900/20 border border-green-500/40 rounded-2xl flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-green-900/40 flex items-center justify-center text-green-400">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-green-300">{{ doc[1] }}</p>
                    <p class="text-[10px] text-green-500 uppercase tracking-widest">Uploaded</p>
                </div>
            </div>
        </div>
        {% else %}
        <div id="slot-{{ doc[0] }}" class="p-4 bg-black/40 border border-slate-800 rounded-2xl flex items-center justify-between group transition-all hover:border-green-500/50">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center text-slate-500 group-hover:bg-green-900/30 group-hover:text-green-400 transition-colors">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-slate-300">{{ doc[1] }}</p>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">Required PDF</p>
                </div>
            </div>
            
            <form hx-post="/drivers/upload-packet" 
                  hx-encoding="multipart/form-data" 
                  hx-target="#slot-{{ doc[0] }}" 
                  hx-swap="outerHTML">
                <input type="hidden" name="doc_type" value="{{ doc[0] }}">
                <label class="cursor-pointer bg-slate-800 hover:bg-green-600 text-white text-xs font-bold px-4 py-2 rounded-lg transition-all">
                    <span>Upload</span>
                    <input type="file" name="file" accept=".pdf" class="hidden" onchange="this.form.requestSubmit()">
                </label>
            </form>
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <div id="finish-area" class="text-center opacity-50 pointer-events-none transition-all">
        <p class="text-slate-500 text-xs mb-4">Complete all 3 uploads to activate your account.</p>
        <a href="/drivers/dashboard?welcome=true" 
           class="block w-full bg-green-600 hover:bg-green-500 text-white font-black py-4 rounded-2xl shadow-lg shadow-green-500/20 active:scale-95 transition-all">
            ENTER DASHBOARD
        </a>
    </div>
</div>

<script>
    // Simple logic to light up the finish button once slots are marked 'done'
    document.body.addEventListener('htmx:afterOnLoad', function(evt) {
        const slots = document.querySelectorAll('.fa-check-circle');
        if (slots.length === 3) {
            const gate = document.getElementById('finish-area');
            gate.classList.remove('opacity-50', 'pointer-events-none');
            gate.querySelector('p').innerText = "System Ready. Pulse active.";
            gate.querySelector('p').classList.replace('text-slate-500', 'text-green-400');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        const slots = document.querySelectorAll('.fa-check-circle');
        if (slots.length === 3) {
            const gate = document.getElementById('finish-area');
            gate.classList.remove('opacity-50', 'pointer-events-none');
            gate.querySelector('p').innerText = "System Ready. Pulse active.";
            gate.querySelector('p').classList.replace('text-slate-500', 'text-green-400');
        }
    });
</script>
{% endblock %}